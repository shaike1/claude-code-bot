#!/usr/bin/expect -f

set timeout 60
log_user 1

spawn claude /login

expect {
    "Choose the text style" {
        puts "=== FOUND THEME SELECTION ==="
        send "1\r"
        exp_continue
    }
    "Choose login method" {
        puts "=== FOUND LOGIN METHOD SELECTION ==="
        send "1\r"
        exp_continue
    }
    "Web Login" {
        puts "=== SELECTING WEB LOGIN ==="
        send "1\r"
        exp_continue
    }
    "console.anthropic.com" {
        puts "=== FOUND CONSOLE URL (not personalized) ==="
        exp_continue
    }
    "https://console.anthropic.com" {
        puts "=== FOUND GENERIC CONSOLE URL ==="
        exp_continue
    }
    -re "https://.*anthropic.*" {
        puts "=== FOUND ANTHROPIC URL: $expect_out(0,string) ==="
        exp_continue
    }
    "API key" {
        puts "=== API KEY OPTION AVAILABLE ==="
        exp_continue
    }
    "Invalid API key" {
        puts "=== NO API KEY SET ==="
        exp_continue
    }
    timeout {
        puts "=== TIMEOUT ==="
        exit 1
    }
    eof {
        puts "=== PROCESS ENDED ==="
        exit 0
    }
}

sleep 5
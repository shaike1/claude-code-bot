#!/usr/bin/expect -f

set timeout 60
log_user 1

spawn claude /login

expect {
    "Choose the text style" {
        puts "\n=== THEME SELECTION ==="
        send "1\r"
        sleep 3
        send "\r"
        sleep 3
        
        expect {
            "Select login method" {
                puts "\n=== GOT LOGIN MENU - SELECTING CONSOLE ACCOUNT ==="
                send "2\r"
                sleep 5
                
                # Capture everything that comes after selecting option 2
                puts "\n=== WAITING FOR URL OUTPUT ==="
                expect {
                    "https" {
                        puts "\n=== FOUND HTTPS URL START ==="
                        exp_continue
                    }
                    "anthropic" {
                        puts "\n=== FOUND ANTHROPIC REFERENCE ==="
                        exp_continue
                    }
                    "console" {
                        puts "\n=== FOUND CONSOLE REFERENCE ==="
                        exp_continue
                    }
                    "auth" {
                        puts "\n=== FOUND AUTH REFERENCE ==="
                        exp_continue
                    }
                    "Open" {
                        puts "\n=== FOUND OPEN INSTRUCTION ==="
                        exp_continue
                    }
                    timeout {
                        puts "\n=== TIMEOUT - CHECKING SCREEN ==="
                    }
                }
            }
            timeout {
                puts "\n=== TIMEOUT WAITING FOR LOGIN MENU ==="
            }
        }
    }
    timeout {
        puts "\n=== INITIAL TIMEOUT ==="
    }
}

puts "\n=== COMPLETE - ENDING SESSION ==="
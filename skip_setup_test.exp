#!/usr/bin/expect -f

set timeout 60
log_user 1

# First, try to complete the setup by selecting theme option 1
spawn claude /login

expect {
    "Choose the text style" {
        puts "\n=== SETUP SCREEN - SELECTING DARK MODE ==="
        send "1\r"
        
        # Wait for the next screen - could be login or something else
        expect {
            "Choose login method" {
                puts "\n=== LOGIN METHOD SCREEN ==="
                send "1\r"
                
                expect {
                    -re "Open this URL in your browser:" {
                        puts "\n=== FOUND URL INSTRUCTION ==="
                        exp_continue
                    }
                    -re "https://console\\.anthropic\\.com.*" {
                        puts "\n=== FOUND LOGIN URL: $expect_out(0,string) ==="
                        exp_continue
                    }
                    -re "Visit https://console\\.anthropic\\.com.*" {
                        puts "\n=== FOUND VISIT INSTRUCTION: $expect_out(0,string) ==="
                        exp_continue
                    }
                    "console.anthropic.com" {
                        puts "\n=== FOUND GENERIC CONSOLE REFERENCE ==="
                        exp_continue
                    }
                    timeout {
                        puts "\n=== TIMEOUT WAITING FOR URL AFTER LOGIN METHOD ==="
                    }
                }
            }
            "Welcome" {
                puts "\n=== WELCOME SCREEN AFTER THEME ==="
                exp_continue
            }
            timeout {
                puts "\n=== TIMEOUT AFTER THEME SELECTION ==="
            }
        }
    }
    timeout {
        puts "\n=== INITIAL TIMEOUT ==="
    }
}

puts "\n=== TEST COMPLETE ==="
sleep 3